<?xml version="1.0" encoding="UTF-8"?>
<BehaviorTree>
  <Root>
    <Sequence name="SkillLifecycleDemo">
      
      <!-- Setup: Connect and Lock -->
      <Sequence name="Setup">
        <ConnectToModule name="Connect" ModuleName="{config.Agent.ModuleId}" />
        <LockResource name="Lock" ModuleName="{config.Agent.ModuleId}" />
        <CheckLockedState name="VerifyLocked" ModuleName="{config.Agent.ModuleId}" ExpectLocked="true" />
      </Sequence>

      <!-- Test 1: Check Ready State -->
      <Sequence name="TestReadyState">
        <CheckReadyState name="IsReady" ModuleName="{config.Agent.ModuleId}" />
      </Sequence>

      <!-- Test 2: Start Skill and Wait for Running -->
      <Sequence name="StartSkillTest">
          <ExecuteSkill 
          name="StartScrew" 
          SkillName="Screw" 
          ModuleName="{config.Agent.ModuleId}"
          Parameters="ProductId=TestProduct"
          WaitForCompletion="false" />
        
          <WaitForSkillState 
          name="WaitRunning" 
          ModuleName="{config.Agent.ModuleId}"
          SkillName="Screw"
          TargetState="Running"
          TimeoutSeconds="10" />
      </Sequence>

      <!-- Test 3: Pause Skill -->
      <Sequence name="PauseTest">
        <Wait name="WaitBeforePause" DurationMs="2000" />
        
        <PauseSkill 
          name="PauseScrew" 
          ModuleName="{config.Agent.ModuleId}"
          SkillName="Screw"
          TimeoutSeconds="10" />
        
          <MonitoringSkill 
          name="CheckPausedState" 
          ModuleName="{config.Agent.ModuleId}"
          SkillName="Screw" />
      </Sequence>

      <!-- Test 4: Resume Skill -->
      <Sequence name="ResumeTest">
        <Wait name="WaitBeforeResume" DurationMs="1000" />
        
        <ResumeSkill 
          name="ResumeScrew" 
          ModuleName="{config.Agent.ModuleId}"
          SkillName="Screw"
          TimeoutSeconds="10" />
        
          <WaitForSkillState 
          name="WaitResumed" 
          ModuleName="{config.Agent.ModuleId}"
          SkillName="Screw"
          TargetState="Running"
          TimeoutSeconds="10" />
      </Sequence>

      <!-- Test 5: Abort Skill -->
      <Sequence name="AbortTest">
        <Wait name="WaitBeforeAbort" DurationMs="1000" />
        
        <AbortSkill 
          name="AbortScrew" 
          ModuleName="{config.Agent.ModuleId}"
          SkillName="Screw"
          WaitForHalted="true"
          TimeoutSeconds="10" />
        
        <CheckErrorState 
          name="CheckNoErrors" 
          ModuleName="{config.Agent.ModuleId}" />
      </Sequence>

      <!-- Cleanup -->
      <Sequence name="Cleanup">
        <UnlockResource name="Unlock" ModuleName="{config.Agent.ModuleId}" />
        <CheckLockedState name="VerifyUnlocked" ModuleName="{config.Agent.ModuleId}" ExpectLocked="false" />
      </Sequence>

    </Sequence>
  </Root>
</BehaviorTree>
